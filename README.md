# IBM Cloud Solution Engineering VPC Cluster Module

This module creates a cluster across any number of subnets in a single VPC. This module is intended to use outputs from the [ICSE Flexible VPC Network Template](https://github.com/Cloud-Schematics/easy-flexible-vpc-network).

---

## Module Variables

Name                            | Type                                                                                                                            | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Sensitive | Default
------------------------------- | ------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- | ---------------------------
region                          | string                                                                                                                          | The region to which to deploy the VPC                                                                                                                                                                                                                                                                                                                                                                                                                                                 |           | 
prefix                          | string                                                                                                                          | The prefix that you would like to prepend to your resources                                                                                                                                                                                                                                                                                                                                                                                                                           |           | 
resource_group_id               | string                                                                                                                          | Resource group ID where the cluster will be provisioned.                                                                                                                                                                                                                                                                                                                                                                                                                              |           | null
tags                            | list(string)                                                                                                                    | List of Tags for the resource created                                                                                                                                                                                                                                                                                                                                                                                                                                                 |           | null
vpc_id                          | string                                                                                                                          | ID of the VPC where the cluster will be provisioned                                                                                                                                                                                                                                                                                                                                                                                                                                   |           | 
subnet_zone_list                | list( object({ name = string id = string zone = optional(string) cidr = optional(string) }) )                                   | List of subnets in the VPC where gateways and reserved IPs will be provisioned. This value is intended to use the `subnet_zone_list` output from the [ICSE VPC Subnet Module](https://github.com/Cloud-Schematics/vpc-subnet-module) or from templates using that module for subnet creation.                                                                                                                                                                                         |           | 
kms_config                      | object({ use_key_protect = bool key_id = optional(string) instance_guid = optional(string) private_endpoint = optional(bool) }) | OPTIONAL - Key Protect Configuration for cluster                                                                                                                                                                                                                                                                                                                                                                                                                                      |           | { use_key_protect = false }
machine_type                    | string                                                                                                                          | The flavor of VPC worker node to use for your cluster. Use `ibmcloud ks flavors` to find flavors for a region.                                                                                                                                                                                                                                                                                                                                                                        |           | bx2.4x16
workers_per_zone                | number                                                                                                                          | Number of workers to provision in each subnet. OpenShift clusters require at least 2 workers. These workers can be spread across multiple zones.                                                                                                                                                                                                                                                                                                                                      |           | 2
kube_version                    | string                                                                                                                          | Specify the Kubernetes version, including the major.minor version. To see available versions, run `ibmcloud ks versions`. To use the default version, leave as `default`.                                                                                                                                                                                                                                                                                                             |           | default
pod_subnet                      | string                                                                                                                          | Specify a custom subnet CIDR to provide private IP addresses for pods. The subnet must have a CIDR of at least /23 or larger.                                                                                                                                                                                                                                                                                                                                                         |           | 172.30.0.0/16
service_subnet                  | string                                                                                                                          | Specify a custom subnet CIDR to provide private IP addresses for services. The subnet must be at least ’/24’ or larger.                                                                                                                                                                                                                                                                                                                                                               |           | 172.21.0.0/16
wait_till                       | string                                                                                                                          | To avoid long wait times when you run your Terraform code, you can specify the stage when you want Terraform to mark the cluster resource creation as completed. Depending on what stage you choose, the cluster creation might not be fully completed and continues to run in the background. However, your Terraform code can continue to run without waiting for the cluster to be fully created. Supported args are `MasterNodeReady`, `OneWorkerNodeReady`, and `IngressReady`   |           | IngressReady
update_all_workers              | bool                                                                                                                            | Update all workers to new kube version                                                                                                                                                                                                                                                                                                                                                                                                                                                |           | false
disable_public_service_endpoint | bool                                                                                                                            | Disable the public service endpoint on the cluster.                                                                                                                                                                                                                                                                                                                                                                                                                                   |           | false
entitlement                     | string                                                                                                                          | OPENSHIFT CLUSTERS ONLY - If you purchased an IBM Cloud Cloud Pak that includes an entitlement to run worker nodes that are installed with OpenShift Container Platform, enter entitlement to create your cluster with that entitlement so that you are not charged twice for the OpenShift license. Note that this option can be set only when you create the cluster. After the cluster is created, the cost for the OpenShift license occurred and you cannot disable this charge. |           | null
cos_instance_crn                | string                                                                                                                          | OPENSHIFT CLUSTERS ONLY - CRN of the COS Instnance for the cluster to use.                                                                                                                                                                                                                                                                                                                                                                                                            |           | null